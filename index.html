<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHubå®šæ—¶æé†’ Â· é£æœºAPIæ°¸ä¹…è‡ªåŠ¨åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #0d1117 0%, #1a1f2b 100%);
            color: #e6edf3;
            padding: 24px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(22, 27, 34, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #30363d;
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 28px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        h1 {
            font-size: 2.2rem;
            background: linear-gradient(135deg, #79c0ff, #56d364, #ffa657);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            gap: 8px;
        }

        .badge-success {
            background: rgba(46, 160, 67, 0.15);
            color: #7ee787;
            border: 1px solid rgba(46, 160, 67, 0.3);
        }

        .badge-warning {
            background: rgba(242, 211, 91, 0.15);
            color: #f2c94c;
            border: 1px solid rgba(242, 211, 91, 0.3);
        }

        .card {
            background: #161b22;
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 28px;
            border: 1px solid #30363d;
            transition: border 0.2s;
        }

        .card:hover {
            border-color: #58a6ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #0d1117;
            padding: 20px;
            border-radius: 16px;
            border: 1px solid #30363d;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: #79c0ff;
            line-height: 1;
            margin-bottom: 4px;
        }

        .github-config {
            background: #0d1117;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #30363d;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group input, 
        .github-config input {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 12px 16px;
            color: #e6edf3;
            width: 100%;
            font-size: 0.95rem;
        }

        .form-group input:focus,
        .github-config input:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #238636;
            color: white;
        }

        .btn-primary:hover {
            background: #2ea043;
        }

        .btn-success {
            background: #1f6feb;
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #30363d;
            color: #e6edf3;
        }

        .btn-outline:hover {
            border-color: #58a6ff;
            color: #58a6ff;
        }

        .reminder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .reminder-card {
            background: #0d1117;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #30363d;
            position: relative;
        }

        .reminder-card.due {
            border-left: 4px solid #f85149;
        }

        .reminder-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #0d1117;
            border-radius: 12px;
            margin-top: 16px;
        }

        .sync-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .sync-indicator.success {
            background: #3fb950;
            box-shadow: 0 0 0 2px rgba(63, 185, 80, 0.2);
        }

        .sync-indicator.error {
            background: #f85149;
        }

        .sync-indicator.syncing {
            background: #f09b43;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #notificationArea {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            max-width: 400px;
        }

        .notification {
            background: #161b22;
            border-radius: 12px;
            padding: 16px 24px;
            margin-bottom: 12px;
            border-left: 4px solid;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { border-left-color: #3fb950; }
        .notification.error { border-left-color: #f85149; }
        .notification.warning { border-left-color: #f09b43; }
        .notification.info { border-left-color: #58a6ff; }

        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .reminder-grid { grid-template-columns: 1fr; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ï¼šå·²å†…ç½®é£æœºTokençŠ¶æ€æ˜¾ç¤º -->
        <div class="header">
            <h1>
                <i class="fas fa-paper-plane"></i>
                é£æœºå®šæ—¶æé†’ Â· æ°¸ä¹…è‡ªåŠ¨åŒ–
                <span class="badge badge-success" id="systemStatusBadge">
                    <i class="fas fa-check-circle"></i>
                    Actionsè¿è¡Œä¸­
                </span>
            </h1>
            <div class="subtitle" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <i class="fas fa-clock"></i>
                    æ¯3åˆ†é’Ÿæ£€æŸ¥ Â· åˆ°æœŸè‡ªåŠ¨å‘é£æœº Â· å…³æµè§ˆå™¨ç…§å¸¸è¿è¡Œ
                </div>
                <span style="background: rgba(88,166,255,0.1); padding: 6px 16px; border-radius: 30px;">
                    <i class="fab fa-telegram"></i>
                    Botå·²ç»‘å®š
                </span>
            </div>
        </div>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">æ€»æé†’æ•°</div>
                <div class="stat-value" id="statTotal">0</div>
                <div style="color: #8b949e;">æ‰€æœ‰å¯ç”¨é¡¹ç›®</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ä»Šæ—¥åˆ°æœŸ</div>
                <div class="stat-value" id="statDue">0</div>
                <div style="color: #8b949e;">ç«‹å³å¤„ç†</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">è¿›è¡Œä¸­</div>
                <div class="stat-value" id="statActive">0</div>
                <div style="color: #8b949e;">æœªåˆ°æœŸ</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">BotçŠ¶æ€</div>
                <div class="stat-value" style="font-size: 1.8rem;" id="botStatusValue">âœ…</div>
                <div style="color: #8b949e;">é£æœºAPIå·²ç»‘å®š</div>
            </div>
        </div>

        <!-- GitHubé…ç½®å¡ç‰‡ï¼šå«Tokenä¿å­˜ -->
        <div class="card">
            <div class="card-header" style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <i class="fab fa-github" style="font-size: 1.8rem; color: #79c0ff;"></i>
                <h2 style="margin: 0;">GitHub åŒæ­¥é…ç½®</h2>
            </div>
            
            <div class="github-config">
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 16px; align-items: center;">
                    <div style="color: #8b949e;">ğŸ‘¤ ç”¨æˆ·å</div>
                    <div>
                        <input type="text" id="githubUsername" value="xiaowei1110000-cmyk" placeholder="GitHubç”¨æˆ·å">
                    </div>
                    
                    <div style="color: #8b949e;">ğŸ“¦ ä»“åº“å</div>
                    <div>
                        <input type="text" id="githubRepo" value="telegram-reminder" placeholder="ä»“åº“åç§°">
                    </div>
                    
                    <div style="color: #8b949e;">ğŸ”‘ Token</div>
                    <div>
                        <div style="display: flex; gap: 8px;">
                            <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                            <button class="btn btn-success" onclick="saveGitHubConfig()">
                                <i class="fas fa-save"></i> ä¿å­˜Token
                            </button>
                        </div>
                        <div style="color: #f09b43; font-size: 0.8rem; margin-top: 6px;">
                            <i class="fas fa-exclamation-triangle"></i> 
                            éœ€è¦repoå’Œworkflowæƒé™ï¼Œ
                            <a href="https://github.com/settings/tokens" target="_blank" style="color: #58a6ff;">ç«‹å³ç”Ÿæˆ</a>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="syncToGitHub()">
                    <i class="fas fa-cloud-upload-alt"></i> ä¿å­˜åˆ°GitHub
                </button>
                <button class="btn btn-primary" onclick="loadFromGitHub()">
                    <i class="fas fa-cloud-download-alt"></i> ä»GitHubåŠ è½½
                </button>
                <button class="btn btn-outline" onclick="triggerActions()">
                    <i class="fas fa-play"></i> æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
                </button>
                <button class="btn btn-outline" onclick="exportBackup()">
                    <i class="fas fa-download"></i> å¯¼å‡ºå¤‡ä»½
                </button>
            </div>

            <div class="sync-status" id="syncStatus">
                <div class="sync-indicator" id="syncIndicator"></div>
                <div style="flex: 1;">
                    <div style="font-weight: 600;" id="syncText">åŒæ­¥çŠ¶æ€: æœªè¿æ¥</div>
                    <div style="color: #8b949e; font-size: 0.85rem;" id="syncTime">æœ€ååŒæ­¥: ä»æœª</div>
                </div>
                <div>
                    <span class="badge badge-warning" id="tokenStatus">
                        <i class="fas fa-key"></i> Tokenæœªé…ç½®
                    </span>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ æé†’å¡ç‰‡ -->
        <div class="card">
            <div class="card-header" style="display: flex; align-items: center; gap: 16px;">
                <i class="fas fa-plus-circle" style="font-size: 1.8rem; color: #79c0ff;"></i>
                <h2>æ–°å»ºæé†’</h2>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label><i class="fas fa-tag"></i> æé†’åç§°</label>
                    <input type="text" id="reminderName" placeholder="ä¾‹å¦‚ï¼šç½‘å®¿IPæ›´æ–°">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-calendar"></i> æœ€åæ›´æ–°</label>
                    <input type="date" id="lastUpdated">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-repeat"></i> é—´éš”(å¤©)</label>
                    <input type="number" id="reminderDays" value="3" min="1" max="365">
                </div>
            </div>

            <button class="btn btn-primary" onclick="addReminder()" style="padding: 14px 32px;">
                <i class="fas fa-plus"></i> æ·»åŠ æé†’
            </button>
        </div>

        <!-- æé†’åˆ—è¡¨å¡ç‰‡ -->
        <div class="card">
            <div class="card-header" style="display: flex; align-items: center; gap: 16px;">
                <i class="fas fa-list-check" style="font-size: 1.8rem; color: #79c0ff;"></i>
                <h2>æé†’åˆ—è¡¨</h2>
                <div style="margin-left: auto;">
                    <span class="badge badge-warning" id="dueBadge">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span id="dueCount">0</span> ä¸ªä»Šæ—¥åˆ°æœŸ
                    </span>
                </div>
            </div>

            <div id="reminderList" class="reminder-grid">
                <!-- åŠ¨æ€æ¸²æŸ“ -->
            </div>
        </div>
    </div>

    <div id="notificationArea"></div>

    <script>
        // ==================== é£æœºTokenå·²å†…ç½® ====================
        // è¿™äº›Tokenä¼šè‡ªåŠ¨æ³¨å…¥åˆ°GitHub Actionsä¸­ï¼Œé€šè¿‡Secretsç®¡ç†
        // ç½‘é¡µç«¯ä»…éœ€é…ç½®GitHub Tokenç”¨äºAPIæ“ä½œ
        
        const TELEGRAM_BOT_TOKEN = '8239139638:AAGbCCpa6Jei3bviOv7uNjMTRAdxJ_4VXG0';
        const TELEGRAM_CHAT_ID = '-1003549797288';
        
        // ==================== å…¨å±€å˜é‡ ====================
        let reminders = [];
        let githubAPI = null;
        let lastSyncTime = null;
        let currentSHA = null;

        // ==================== GitHub API ç±» ====================
        class GitHubAPI {
            constructor(username, repo, token) {
                this.username = username;
                this.repo = repo;
                this.token = token;
                this.baseUrl = `https://api.github.com/repos/${username}/${repo}`;
            }

            async getRemindersFile() {
                try {
                    const url = `${this.baseUrl}/contents/reminders.json`;
                    const response = await fetch(url, {
                        headers: {
                            'Accept': 'application/vnd.github.v3+json',
                            'Authorization': `token ${this.token}`
                        }
                    });
                    
                    if (response.status === 404) return { success: false, exists: false };
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const data = await response.json();
                    let content = '';
                    try {
                        content = decodeURIComponent(escape(atob(data.content.replace(/\n/g, ''))));
                    } catch(e) {
                        content = atob(data.content.replace(/\n/g, ''));
                    }
                    
                    return {
                        success: true,
                        exists: true,
                        content: content,
                        sha: data.sha
                    };
                } catch(error) {
                    return { success: false, error: error.message };
                }
            }

            async updateRemindersFile(content, sha = null) {
                try {
                    if (!sha) {
                        const fileInfo = await this.getRemindersFile();
                        sha = fileInfo.sha;
                    }
                    
                    let encodedContent = '';
                    try {
                        encodedContent = btoa(unescape(encodeURIComponent(content)));
                    } catch(e) {
                        encodedContent = btoa(content);
                    }
                    
                    const response = await fetch(`${this.baseUrl}/contents/reminders.json`, {
                        method: 'PUT',
                        headers: {
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'Authorization': `token ${this.token}`
                        },
                        body: JSON.stringify({
                            message: 'ğŸ“… ç½‘é¡µç«¯æ›´æ–°æé†’æ•°æ®',
                            content: encodedContent,
                            sha: sha || undefined
                        })
                    });
                    
                    if (!response.ok) throw new Error('æ›´æ–°å¤±è´¥');
                    const result = await response.json();
                    return { success: true, sha: result.content.sha };
                } catch(error) {
                    return { success: false, error: error.message };
                }
            }

            async triggerActions() {
                try {
                    const response = await fetch(`${this.baseUrl}/actions/workflows/send-reminder.yml/dispatches`, {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'Authorization': `token ${this.token}`
                        },
                        body: JSON.stringify({ ref: 'main' })
                    });
                    return { success: response.status === 204 };
                } catch(error) {
                    return { success: false, error: error.message };
                }
            }
        }

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', async () => {
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const today = new Date();
            today.setHours(today.getHours() + 8);
            document.getElementById('lastUpdated').value = today.toISOString().split('T')[0];
            
            // åŠ è½½ä¿å­˜çš„é…ç½®
            const savedUsername = localStorage.getItem('github_username') || 'xiaowei1110000-cmyk';
            const savedRepo = localStorage.getItem('github_repo') || 'telegram-reminder';
            const savedToken = localStorage.getItem('github_token');
            
            document.getElementById('githubUsername').value = savedUsername;
            document.getElementById('githubRepo').value = savedRepo;
            
            if (savedToken) {
                document.getElementById('githubToken').value = savedToken;
                document.getElementById('tokenStatus').innerHTML = '<i class="fas fa-key"></i> Tokenå·²é…ç½®';
                document.getElementById('tokenStatus').className = 'badge badge-success';
                
                githubAPI = new GitHubAPI(savedUsername, savedRepo, savedToken);
                await loadFromGitHub();
            } else {
                showNotification('âš ï¸ è¯·é…ç½®GitHub Tokenä»¥å®ç°äº‘ç«¯åŒæ­¥', 'warning');
            }
            
            // æ˜¾ç¤ºé£æœºTokençŠ¶æ€ï¼ˆå·²å†…ç½®ï¼‰
            document.getElementById('botStatusValue').innerHTML = 'âœ… å·²ç»‘å®š';
            
            renderReminders();
        });

        // ==================== GitHubåŒæ­¥å‡½æ•° ====================
        async function saveGitHubConfig() {
            const username = document.getElementById('githubUsername').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            
            if (!username || !repo || !token) {
                showNotification('è¯·å®Œæ•´å¡«å†™ç”¨æˆ·åã€ä»“åº“åå’ŒToken', 'error');
                return;
            }
            
            localStorage.setItem('github_username', username);
            localStorage.setItem('github_repo', repo);
            localStorage.setItem('github_token', token);
            
            githubAPI = new GitHubAPI(username, repo, token);
            
            document.getElementById('tokenStatus').innerHTML = '<i class="fas fa-key"></i> Tokenå·²é…ç½®';
            document.getElementById('tokenStatus').className = 'badge badge-success';
            
            showNotification('âœ… GitHubé…ç½®å·²ä¿å­˜', 'success');
            setTimeout(() => loadFromGitHub(), 500);
        }

        async function syncToGitHub() {
            if (!githubAPI) {
                showNotification('âŒ è¯·å…ˆé…ç½®å¹¶ä¿å­˜Token', 'error');
                return;
            }
            
            try {
                updateSyncStatus('syncing', 'æ­£åœ¨ä¿å­˜åˆ°GitHub...');
                const content = JSON.stringify(reminders, null, 2);
                const result = await githubAPI.updateRemindersFile(content, currentSHA);
                
                if (result.success) {
                    currentSHA = result.sha;
                    lastSyncTime = new Date();
                    updateSyncStatus('success', 'åŒæ­¥æˆåŠŸ', formatTime(lastSyncTime));
                    showNotification('âœ… å·²ä¿å­˜åˆ°GitHub', 'success');
                    
                    // è§¦å‘Actions
                    await githubAPI.triggerActions();
                    showNotification('â° å·²è§¦å‘GitHub Actionsï¼Œ3åˆ†é’Ÿå†…ä¼šæ”¶åˆ°é£æœºæé†’', 'info');
                } else {
                    throw new Error(result.error);
                }
            } catch(error) {
                updateSyncStatus('error', 'åŒæ­¥å¤±è´¥', error.message);
                showNotification('âŒ ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function loadFromGitHub() {
            if (!githubAPI) {
                updateSyncStatus('error', 'è¯·å…ˆé…ç½®Token', 'æœªé…ç½®');
                return;
            }
            
            try {
                updateSyncStatus('syncing', 'æ­£åœ¨ä»GitHubåŠ è½½...');
                const result = await githubAPI.getRemindersFile();
                
                if (result.success && result.exists) {
                    try {
                        reminders = JSON.parse(result.content);
                        currentSHA = result.sha;
                        lastSyncTime = new Date();
                        updateSyncStatus('success', 'åŠ è½½æˆåŠŸ', formatTime(lastSyncTime));
                        renderReminders();
                        showNotification(`âœ… å·²åŠ è½½ ${reminders.length} ä¸ªæé†’`, 'success');
                    } catch(e) {
                        createDefaultReminders();
                    }
                } else {
                    createDefaultReminders();
                }
            } catch(error) {
                updateSyncStatus('error', 'åŠ è½½å¤±è´¥', error.message);
                createDefaultReminders();
            }
        }

        async function triggerActions() {
            if (!githubAPI) {
                showNotification('âŒ è¯·å…ˆé…ç½®Token', 'error');
                return;
            }
            showNotification('â³ æ­£åœ¨è§¦å‘GitHub Actions...', 'info');
            const result = await githubAPI.triggerActions();
            if (result.success) {
                showNotification('âœ… å·²è§¦å‘æ‰‹åŠ¨æ£€æŸ¥ï¼Œé£æœºæ¶ˆæ¯å³å°†å‘é€', 'success');
            } else {
                showNotification('âŒ è§¦å‘å¤±è´¥: ' + result.error, 'error');
            }
        }

        // ==================== æé†’ç®¡ç† ====================
        function addReminder() {
            const name = document.getElementById('reminderName').value.trim();
            const lastUpdated = document.getElementById('lastUpdated').value;
            const days = parseInt(document.getElementById('reminderDays').value);
            
            if (!name || !lastUpdated || !days) {
                showNotification('è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                return;
            }
            
            const nextDate = new Date(lastUpdated);
            nextDate.setDate(nextDate.getDate() + days);
            const nextStr = nextDate.toISOString().split('T')[0];
            
            reminders.push({
                id: Date.now(),
                name: name,
                lastUpdated: lastUpdated,
                nextReminder: nextStr,
                days: days,
                createdAt: new Date().toISOString(),
                enabled: true,
                notified: false,
                lastSentTime: null
            });
            
            renderReminders();
            showNotification(`âœ… å·²æ·»åŠ : ${name}`, 'success');
            
            document.getElementById('reminderName').value = '';
            document.getElementById('reminderDays').value = '3';
            
            // è‡ªåŠ¨åŒæ­¥
            setTimeout(() => syncToGitHub(), 500);
        }

        function markAsDone(id) {
            const reminder = reminders.find(r => r.id === id);
            if (reminder) {
                const today = new Date();
                today.setHours(today.getHours() + 8);
                const todayStr = today.toISOString().split('T')[0];
                
                const nextDate = new Date(todayStr);
                nextDate.setDate(nextDate.getDate() + reminder.days);
                
                reminder.lastUpdated = todayStr;
                reminder.nextReminder = nextDate.toISOString().split('T')[0];
                reminder.notified = false;
                
                renderReminders();
                showNotification(`âœ… ${reminder.name} å·²æ›´æ–°`, 'success');
                setTimeout(() => syncToGitHub(), 500);
            }
        }

        function deleteReminder(id) {
            if (confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªæé†’å—ï¼Ÿ')) {
                reminders = reminders.filter(r => r.id !== id);
                renderReminders();
                showNotification('âœ… å·²åˆ é™¤', 'success');
                setTimeout(() => syncToGitHub(), 500);
            }
        }

        function editReminder(id) {
            const reminder = reminders.find(r => r.id === id);
            if (reminder) {
                document.getElementById('reminderName').value = reminder.name;
                document.getElementById('lastUpdated').value = reminder.lastUpdated;
                document.getElementById('reminderDays').value = reminder.days;
                deleteReminder(id);
            }
        }

        function exportBackup() {
            const content = JSON.stringify(reminders, null, 2);
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reminders-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('âœ… å·²å¯¼å‡ºå¤‡ä»½', 'success');
        }

        function createDefaultReminders() {
            const today = new Date();
            today.setHours(today.getHours() + 8);
            const todayStr = today.toISOString().split('T')[0];
            
            const nextDate = new Date(todayStr);
            nextDate.setDate(nextDate.getDate() + 3);
            
            reminders = [
                {
                    id: Date.now(),
                    name: 'ğŸ“ ç½‘å®¿IPæ›´æ–°',
                    lastUpdated: todayStr,
                    nextReminder: todayStr,
                    days: 3,
                    createdAt: new Date().toISOString(),
                    enabled: true,
                    notified: false,
                    lastSentTime: null
                },
                {
                    id: Date.now() + 1,
                    name: 'ğŸ”’ SSLè¯ä¹¦ç»­æœŸ',
                    lastUpdated: todayStr,
                    nextReminder: nextDate.toISOString().split('T')[0],
                    days: 7,
                    enabled: true,
                    notified: false
                }
            ];
            renderReminders();
        }

        // ==================== æ¸²æŸ“ ====================
        function renderReminders() {
            const container = document.getElementById('reminderList');
            const today = new Date();
            today.setHours(today.getHours() + 8);
            const todayStr = today.toISOString().split('T')[0];
            
            if (!reminders || reminders.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: #8b949e;">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <p>æš‚æ— æé†’é¡¹ç›®ï¼Œç‚¹å‡»ä¸Šæ–¹æ·»åŠ </p>
                        <button class="btn btn-outline" onclick="createDefaultReminders()" style="margin-top: 20px;">
                            <i class="fas fa-magic"></i> åˆ›å»ºç¤ºä¾‹
                        </button>
                    </div>
                `;
                updateStats();
                return;
            }
            
            let html = '';
            let dueCount = 0;
            
            reminders.forEach(reminder => {
                const isDue = reminder.nextReminder === todayStr;
                if (isDue) dueCount++;
                
                html += `
                    <div class="reminder-card ${isDue ? 'due' : ''}">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="font-size: 1.2rem; font-weight: 600;">${reminder.name}</span>
                            ${isDue ? '<span style="background: rgba(248,81,73,0.2); color: #f85149; padding: 4px 12px; border-radius: 20px;">ä»Šæ—¥åˆ°æœŸ</span>' : ''}
                        </div>
                        
                        <div class="reminder-meta">
                            <div>
                                <div style="color: #8b949e;">æœ€åæ›´æ–°</div>
                                <div>${reminder.lastUpdated}</div>
                            </div>
                            <div>
                                <div style="color: #8b949e;">ä¸‹æ¬¡æé†’</div>
                                <div style="${isDue ? 'color: #f85149; font-weight: 600;' : ''}">${reminder.nextReminder}</div>
                            </div>
                            <div>
                                <div style="color: #8b949e;">é—´éš”</div>
                                <div>${reminder.days}å¤©</div>
                            </div>
                            <div>
                                <div style="color: #8b949e;">çŠ¶æ€</div>
                                <div>${reminder.notified ? 'å·²é€šçŸ¥' : 'å¾…é€šçŸ¥'}</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-primary" onclick="markAsDone(${reminder.id})" style="flex: 1; padding: 8px;">
                                <i class="fas fa-check"></i> è®¾ä¸ºä»Šå¤©
                            </button>
                            <button class="btn btn-outline" onclick="editReminder(${reminder.id})" style="padding: 8px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline" onclick="deleteReminder(${reminder.id})" style="padding: 8px; color: #f85149;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateStats();
            document.getElementById('dueCount').textContent = dueCount;
        }

        function updateStats() {
            const today = new Date();
            today.setHours(today.getHours() + 8);
            const todayStr = today.toISOString().split('T')[0];
            
            document.getElementById('statTotal').textContent = reminders.length;
            document.getElementById('statDue').textContent = reminders.filter(r => r.nextReminder === todayStr).length;
            document.getElementById('statActive').textContent = reminders.filter(r => r.nextReminder > todayStr).length;
        }

        function updateSyncStatus(status, text, time = null) {
            const indicator = document.getElementById('syncIndicator');
            const syncText = document.getElementById('syncText');
            const syncTime = document.getElementById('syncTime');
            
            indicator.className = 'sync-indicator';
            if (status === 'success') {
                indicator.classList.add('success');
                syncText.innerHTML = '<span style="color: #7ee787;">âœ“ ' + text + '</span>';
            } else if (status === 'error') {
                indicator.classList.add('error');
                syncText.innerHTML = '<span style="color: #f85149;">âœ— ' + text + '</span>';
            } else if (status === 'syncing') {
                indicator.classList.add('syncing');
                syncText.innerHTML = 'â³ ' + text;
            }
            
            if (time) syncTime.textContent = 'æœ€ååŒæ­¥: ' + time;
        }

        function formatTime(date) {
            if (!date) return 'ä»æœª';
            const d = new Date(date);
            const now = new Date();
            const diff = Math.floor((now - d) / 1000 / 60);
            if (diff < 1) return 'åˆšåˆš';
            if (diff < 60) return `${diff}åˆ†é’Ÿå‰`;
            if (diff < 1440) return `${Math.floor(diff / 60)}å°æ—¶å‰`;
            return d.toLocaleDateString('zh-CN');
        }

        function showNotification(message, type = 'info') {
            const area = document.getElementById('notificationArea');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                <div style="flex: 1;">${message}</div>
                <i class="fas fa-times" style="cursor: pointer; opacity: 0.7;" onclick="this.remove()"></i>
            `;
            
            area.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }
    </script>
</body>
</html>
